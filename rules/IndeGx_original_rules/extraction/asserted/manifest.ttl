@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix kgi: <http://ns.inria.fr/kg/index#> .
@prefix earl: <http://www.w3.org/ns/earl#> .
@prefix prov: <http://www.w3.org/ns/prov#> .

<> a mf:Manifest ;
    mf:entries  (
            <endpointDescResource.ttl>
            <datasetDescResource.ttl>
            <linksets.ttl>
        ) .

<endpointDescResource.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?endpointDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResource.ttl#activity> .
                        <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResource.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResource.ttl> ;
                            prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                }
                """
        ]
        [
            kgi:recommendedPagination 100 ;
            mf:action """
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res ?p ?o .
                        ?res a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                            sd:endpoint $rawEndpointUrl .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription a prov:Entity , earl:TestSubject ;
                             kgi:originalResource ?res .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            ?res sd:endpoint ?endpointUrl .
                            ?res ?p ?o .
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            ?res sd:endpoint ?endpointUrl .
                            ?res ?p ?o .
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            kgi:recommendedPagination 100 ;
            mf:action """
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res ?p ?o .
                        ?res a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                            sd:endpoint $rawEndpointUrl .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription a prov:Entity , earl:TestSubject ;
                             kgi:originalResource ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            GRAPH ?g {
                                ?res sd:endpoint ?endpointUrl .
                                ?res ?p ?o .
                            }
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            GRAPH ?g {
                                ?res sd:endpoint ?endpointUrl .
                                ?res ?p ?o .
                            }
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            kgi:recommendedPagination 100 ;
            mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                       ?s ?p ?res .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription kgi:originalResource ?res .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            ?res sd:endpoint ?endpointUrl .
                            ?s ?p ?res .
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            ?res sd:endpoint ?endpointUrl .
                            ?s ?p ?res .
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            kgi:recommendedPagination 100 ;
            mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                       ?s ?p ?res .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription kgi:originalResource ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            GRAPH ?g {
                                ?res sd:endpoint ?endpointUrl .
                                ?s ?p ?res .
                            }
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            GRAPH ?g {
                                ?res sd:endpoint ?endpointUrl .
                                ?s ?p ?res .
                            }
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]

    ) ;
    kgi:onFailure (
        <endpointDescResourceLocalhost.ttl>
    ).

<endpointDescResourceLocalhost.ttl>
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?endpointDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResourceLocalhost.ttl#activity> .
                        <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResourceLocalhost.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/endpointDescResourceLocalhost.ttl> ;
                            prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                }
            """
        ]
        [
            mf:action """
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res ?p ?o ;
                            a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                            sd:endpoint $rawEndpointUrl .
                   }
                   GRAPH ?metadataDescriptionGraph {
                        ?endpointDescription prov:wasDerivedFrom ?res .
                        ?metadataDescription a prov:Entity , earl:TestSubject ;
                             kgi:originalResource ?res .
                   }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        ?res sd:endpoint ?endpoint .
                        ?res ?p ?o .
                    }
                    FILTER(CONTAINS(str(?endpoint), "localhost"))
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            mf:action """
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res ?p ?o ;
                            a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                            sd:endpoint $rawEndpointUrl .
                   }
                   GRAPH ?metadataDescriptionGraph {
                        ?endpointDescription prov:wasDerivedFrom ?res .
                        ?metadataDescription a prov:Entity , earl:TestSubject ;
                             kgi:originalResource ?res .
                   }
                   GRAPH ?curatedDescriptionGraph {
                       ?datasetDescription sd:namedGraph ?g .
                       ?g a sd:NamedGraph ;
                           dcterms:relation ?res ;
                           sd:name ?g .
                   }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        GRAPH ?g {
                            ?res sd:endpoint ?endpoint .
                            ?res ?p ?o .
                        }
                    }
                    FILTER(CONTAINS(str(?endpoint), "localhost"))
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?s ?p ?res .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?endpointDescription prov:wasDerivedFrom ?res .
                        ?metadataDescription kgi:originalResource ?res .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        ?res sd:endpoint ?endpoint .
                        ?s ?p ?res .
                    }
                   FILTER(CONTAINS(str(?endpoint), "localhost"))
                   BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                   BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]
        [
            mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?s ?p ?res .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription kgi:originalResource ?res .
                        ?endpointDescription prov:wasDerivedFrom ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                } WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        GRAPH ?g {
                            ?res sd:endpoint ?endpoint .
                            ?s ?p ?res .
                        }
                    }
                   FILTER(CONTAINS(str(?endpoint), "localhost"))
                   BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Endpoint")) AS ?endpointDescription)
                   BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                   BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                }"""
        ]

    ) .

<datasetDescResource.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?datasetDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/datasetDescResource.ttl#activity> .
                        <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/datasetDescResource.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/datasetDescResource.ttl> ;
                            prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
                        ?metadataDescription a prov:Entity , earl:TestSubject .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity ;
                            ?pp ?o .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?datasetDescription prov:wasDerivedFrom ?res .
                        ?metadataDescription kgi:originalResource ?res .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpointUrl .
                            ?res ?pp ?o .
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpointUrl .
                            ?res ?pp ?o .
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity ;
                            ?pp ?o .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?datasetDescription prov:wasDerivedFrom ?res .
                        ?metadataDescription kgi:originalResource ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            GRAPH ?g {
                                { ?res a dcat:Dataset }
                                UNION { ?res a void:Dataset }
                                ?res ?p ?endpointUrl .
                                ?res ?pp ?o .
                            }
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            GRAPH ?g {
                                { ?res a dcat:Dataset }
                                UNION { ?res a void:Dataset }
                                ?res ?p ?endpointUrl .
                                ?res ?pp ?o .
                            }
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription kgi:originalResource ?res .
                        ?datasetDescription prov:wasDerivedFrom ?res .
                    }
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity .
                        ?s ?pp ?res .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpointUrl .
                            ?s ?pp ?res
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpointUrl .
                            ?s ?pp ?res .
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription kgi:originalResource ?res .
                        ?datasetDescription prov:wasDerivedFrom ?res .
                    }
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity .
                        ?s ?pp ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "http://", "https://")) AS ?endpointUrl)
                            GRAPH ?g {
                                { ?res a dcat:Dataset }
                                UNION { ?res a void:Dataset }
                                ?res ?p ?endpointUrl .
                                ?s ?pp ?res .
                            }
                        }
                        UNION {
                            BIND(Iri(REPLACE(str($rawEndpointUrl), "https://", "http://")) AS ?endpointUrl)
                            GRAPH ?g {
                                { ?res a dcat:Dataset }
                                UNION { ?res a void:Dataset }
                                ?res ?p ?endpointUrl .
                                ?s ?pp ?res .
                            }
                        }
                    }
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        ) ;
        kgi:onFailure (
            <datasetDescResourceLocalhost.ttl>
        ) .

<datasetDescResourceLocalhost.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity ;
                            ?pp ?o .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?datasetDescription  prov:wasDerivedFrom ?res .
                        ?metadataDescription kgi:originalResource ?res .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        {
                            ?res a dcat:Dataset
                        }
                        UNION {
                            ?res a void:Dataset
                        }
                        ?res ?p ?endpoint .
                        ?res ?pp ?o .
                    }
                    FILTER( CONTAINS( str(?endpoint), "localhost") )
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX dcterms: <http://purl.org/dc/terms/>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?originalDescriptionGraph {
                        ?res a dcat:Dataset , void:Dataset , prov:Entity ;
                            ?pp ?o .
                    }
                    GRAPH ?metadataDescriptionGraph {
                        ?datasetDescription  prov:wasDerivedFrom ?res .
                        ?metadataDescription kgi:originalResource ?res .
                    }
                    GRAPH ?curatedDescriptionGraph {
                        ?datasetDescription sd:namedGraph ?g .
                        ?g a sd:NamedGraph ;
                            dcterms:relation ?res ;
                            sd:name ?g .
                    }
                }
                WHERE {
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                    SERVICE $rawEndpointUrl {
                        GRAPH ?g {
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpoint .
                            ?res ?pp ?o .
                        }
                    }
                    FILTER( CONTAINS( str(?endpoint), "localhost") )
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                INSERT {
                    GRAPH ?metadataDescriptionGraph {
                        ?metadataDescription a prov:Entity , earl:TestSubject ;
                            prov:wasDerivedFrom ?res ;
                            kgi:original ?originalDescriptionGraph .
                    }
                    GRAPH ?originalDescriptionGraph {
                        ?datasetDescription a dcat:Dataset , void:Dataset , prov:Entity .
                        ?s ?pp ?datasetDescription .
                    }
                }
                WHERE {
                    SERVICE $rawEndpointUrl {
                        {
                            { ?res a dcat:Dataset }
                            UNION { ?res a void:Dataset }
                            ?res ?p ?endpoint .
                            ?s ?pp ?res .
                        }
                        UNION {
                            GRAPH ?g {
                                { ?res a dcat:Dataset }
                                UNION { ?res a void:Dataset }
                                ?res ?p ?endpoint .
                                ?s ?pp ?res .
                            }
                        }
                    }
                    FILTER( CONTAINS( str(?endpoint), "localhost") )
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Metadata")) AS ?metadataDescription)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
                    BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                 }"""
        ]

    ) .

<linksets.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            INSERT {
                GRAPH ?metadataDescriptionGraph {
                    ?linkset prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/linksets.ttl#activity> .
                    <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/linksets.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/IndeGx/main/rules/extraction/asserted/linksets.ttl> ;
                        prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
                }
            } WHERE {
                SERVICE $rawEndpointUrl {
                    ?linkset a void:Linkset .
                    ?linkset ?p ?o .
                    FILTER( ! isBlank(?o) )
                }
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Metadata")) AS ?metadataDescriptionGraph)
            }
            """
        ]
        [
            kgi:recommendedPagination 100 ;
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            INSERT {
                GRAPH ?curatedDescriptionGraph {
                    ?linkset a void:Linkset .
                    ?linkset ?p ?o .
                    ?datasetDescription kgi:linkset ?linkset .
                }
            } WHERE {
                SERVICE $rawEndpointUrl {
                    ?linkset a void:Linkset .
                    ?linkset ?p ?o .
                    FILTER( ! isBlank(?o) )
                }
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "Dataset")) AS ?datasetDescription)
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Original")) AS ?originalDescriptionGraph)
                BIND(Iri(CONCAT(str(kgi:), MD5(str($rawEndpointUrl)), "_", DAY(NOW()), "-", MONTH(NOW()), "-", YEAR(NOW()) , "_" , "Curated")) AS ?curatedDescriptionGraph)
            }
            """
        ]
    ) .
